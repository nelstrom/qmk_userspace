Key Changes:
1. ✅ Directory name: Changed from docs/ to website/ throughout
2. ✅ Documentation philosophy: layout.yaml is the SOURCE OF TRUTH - shows user perspective, not implementation details
3. ✅ Symbol tables: Will show ALL methods comprehensively from user perspective
4. ✅ Implementation approach: Incremental with checkpoints after each milestone
5. ✅ Categories: Using the proposed categories (letters, numbers, punctuation, common, non-printing, rare)
6. ✅ Removed: No parsing of keymap.c - documentation driven purely by layout.yaml

The plan is ready for implementation. We'll proceed incrementally:
- Milestone 1: SVG generation → CHECKPOINT
- Milestone 2: Data processing → CHECKPOINT
- Milestone 3: Templates & symbol tables → CHECKPOINT
- Milestone 4: Theming → CHECKPOINT
- Milestone 5: GitHub Actions deployment → CHECKPOINT

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Ready to code?

Here is Claude's plan:
╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌
Eleventy Documentation Site for QMK Keymaps

Overview

Build a static documentation website using Eleventy to visualize QMK keymaps with:
- SVG layer diagrams (generated by keymap-drawer from layout.yaml)
- Symbol index tables (showing which key combinations produce each symbol)
- Light/dark mode theming
- Local development server
- GitHub Pages deployment

Repository Structure

qmk_userspace/
├── keyboards/ferris/sweep/keymaps/qwerty/
│   ├── keymap.c                      # Existing - implementation
│   └── layout.yaml                   # Existing - SOURCE OF TRUTH (5 layers)
├── website/                          # NEW - Eleventy project root
│   ├── .eleventy.js                  # Configuration
│   ├── package.json                  # Dependencies: @11ty/eleventy, js-yaml
│   ├── src/
│   │   ├── _data/
│   │   │   ├── keymaps.js            # Parses layout.yaml (user perspective)
│   │   │   └── symbolMapping.json    # Keycode → description mapping
│   │   ├── _includes/
│   │   │   ├── layouts/base.njk      # HTML template
│   │   │   ├── layouts/keymap.njk    # Per-keymap page
│   │   │   └── partials/symbol-table.njk
│   │   └── index.njk                 # Landing page
│   ├── public/
│   │   ├── css/theme.css             # Light/dark mode variables
│   │   └── generated/                # SVGs from keymap-drawer
│   └── _site/                        # Build output (gitignored)
├── scripts/                          # NEW - Build orchestration
│   ├── generate-svgs.js              # Runs keymap-drawer
│   └── discover-keymaps.js           # Finds all layout.yaml files
└── .github/workflows/
   └── build_website.yaml            # NEW - CI/CD for website

Build Pipeline

Phase 1: SVG Generation (Node.js → Python)

1. scripts/generate-svgs.js finds all layout.yaml files in keyboards/
2. For each file, runs: keymap-drawer parse -c <layout.yaml> -o website/public/generated/
3. Generates SVG for each layer (BASE, SHIFT, ALT, SHIFT_ALT, NAV)

Phase 2: Data Processing (Eleventy)

1. src/_data/keymaps.js parses all layout.yaml files using js-yaml
2. Source of Truth: layout.yaml defines the complete keymap from user perspective
3. Builds symbol accessibility map showing ALL ways to type each symbol
4. Returns array of keymap objects for template use

Phase 3: Site Build (Eleventy)

1. Index page lists all keyboards/keymaps
2. Keymap pages show layer diagrams + symbol tables
3. Templates use symbolMapping.json to convert keycodes to descriptions

Key Technical Decisions

Documentation Philosophy

User Perspective, Not Implementation:
- layout.yaml is the SOURCE OF TRUTH defining how the keymap works
- Show ALL ways to type each symbol (comprehensive symbol tables)
- Hide implementation details (don't reference keymap.c internals)
- Focus on "what can I type and how" rather than "how is this coded"

Symbol Mapping Strategy

Approach: Manual JSON file mapping QMK keycodes to metadata
- Maps KC_A → {symbol: "a", description: "Lowercase a", category: "letters"}
- Categories: letters, numbers, punctuation, common, non-printing, rare
- Fallback heuristics for unmapped codes

Why: QMK has 500+ keycodes; manual curation ensures accuracy for commonly used ones

Data Source

layout.yaml as Single Source:
- Parse layout.yaml to extract all layers and key definitions
- Show all symbol access methods defined in the YAML
- Symbol tables comprehensive: show every way to type each character
- NO parsing of keymap.c (implementation detail)

Theming Implementation

Approach: CSS custom properties with prefers-color-scheme media query
:root { --color-bg: #ffffff; }
@media (prefers-color-scheme: dark) {
 :root { --color-bg: #1a1a1a; }
}
SVG theming: Override CSS classes in generated SVGs or use CSS filters

Implementation Sequence (Incremental with Checkpoints)

Milestone 1: Foundation & SVG Generation

Goal: Generate visual layer diagrams

1. Create website/ directory structure
2. Initialize package.json with Eleventy + js-yaml
3. Create basic .eleventy.js config
4. Implement scripts/generate-svgs.js
5. Install keymap-drawer (Python: pip install keymap-drawer)
6. Generate SVGs for existing qwerty keymap

Output: SVG files in website/public/generated/ferris-sweep-qwerty/
CHECKPOINT: Review SVG diagrams before proceeding

Milestone 2: Data Processing

Goal: Parse layout.yaml into structured data

1. Create symbolMapping.json with initial 50-100 keycodes
2. Implement scripts/discover-keymaps.js to find all layout.yaml files
3. Implement src/_data/keymaps.js to parse layout.yaml
4. Build data structure: array of keymaps with layers and accessible symbols

Output: Data available to templates via keymaps global
CHECKPOINT: Review data structure and symbol extraction

Milestone 3: Templates & Symbol Tables

Goal: Create web pages with comprehensive symbol tables

1. Create base.njk HTML layout
2. Create index.njk landing page (list keyboards)
3. Create keymap.njk page (embed SVGs + symbol tables)
4. Implement symbol-table.njk partial with category grouping
5. Add filters: formatKeyCombination, keycodeDesc

Output: Functional site with diagrams and comprehensive symbol tables
CHECKPOINT: Review symbol table accuracy and completeness

Milestone 4: Theming

Goal: Light/dark mode support

1. Create public/css/theme.css with light/dark variables
2. Style base layout, tables, and typography
3. Test SVG rendering in both modes
4. Implement SVG theming (CSS classes or filters)

Output: Working light/dark mode with system preference detection
CHECKPOINT: Review visual design in both themes

Milestone 5: GitHub Actions & Deployment

Goal: Automated publishing to GitHub Pages

1. Create .github/workflows/build_website.yaml
2. Configure workflow to install Python + Node.js
3. Run SVG generation → Eleventy build → deploy to Pages
4. Create .nojekyll file in root
5. Enable GitHub Pages in repo settings

Output: Live website automatically deployed on push
CHECKPOINT: Verify live deployment works

Critical Files

Existing (to read):
- keyboards/ferris/sweep/keymaps/qwerty/layout.yaml - Source data
- keyboards/ferris/sweep/keymaps/qwerty/keymap.c - Key override definitions

To create:
- website/.eleventy.js - Core configuration
- website/package.json - Dependencies
- website/src/_data/keymaps.js - Data processing pipeline (layout.yaml only)
- website/src/_data/symbolMapping.json - Keycode mappings
- scripts/generate-svgs.js - SVG generation orchestration
- scripts/discover-keymaps.js - Find all layout.yaml files
- .github/workflows/build_website.yaml - CI/CD pipeline

Local Development Workflow

# First-time setup
cd website
npm install
pip install keymap-drawer  # or: pipx install keymap-drawer

# Daily development
npm run dev  # Runs prebuild (SVG gen) + Eleventy dev server
# Open http://localhost:8080

# Production build
npm run build

Note: Implementation will be incremental with checkpoints after each milestone for review.

Challenges & Solutions

Challenge 1: Complex Keycode Syntax
- layout.yaml uses {h: Gui, t: d}, OSM Shift, TO(NAV), custom labels
- Solution: Parser function handles each syntax type differently

Challenge 2: Multiple Symbol Access Methods
- Some symbols accessible via multiple layers or modifier combinations
- Solution: Show all methods in table - comprehensive from user perspective

Challenge 3: Symbol Categorization
- Need to group 200+ symbols into meaningful categories
- Solution: Manual curation (letters/numbers/punctuation/common/non-printing/rare) with fallback heuristics

Challenge 4: Keeping layout.yaml as Source of Truth
- Must ensure layout.yaml is complete and doesn't require parsing keymap.c
- Solution: Document only what's in layout.yaml; update YAML if needed to be comprehensive

Success Criteria

Implementation complete when:
1. ✓ SVG diagrams display for all 5 layers
2. ✓ Symbol table shows 100+ categorized symbols
3. ✓ "Which keys to press" is accurate (spot-check 20 symbols)
4. ✓ Light/dark mode works via system preference
5. ✓ Local dev server runs with hot reload
6. ✓ GitHub Actions deploys to Pages automatically
7. ✓ Documentation includes setup instructions

Dependencies

Node.js (package.json):
- @11ty/eleventy - Static site generator
- js-yaml - YAML parsing

Python (pip/pipx):
- keymap-drawer - SVG generation tool

GitHub Actions:
- Python 3.12+ for keymap-drawer
- Node.js 20 for Eleventy
- GitHub Pages enabled in repo settings
